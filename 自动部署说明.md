# è‡ªåŠ¨éƒ¨ç½²é…ç½®ï¼ˆGitee + Dockerï¼‰

## ä¸€é”®é…ç½®

åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼š

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/your/project

# 2. è¿è¡Œé…ç½®è„šæœ¬
bash setup-auto-deploy.sh
```

å®Œæˆï¼ç°åœ¨æ¯ 5 åˆ†é’Ÿä¼šè‡ªåŠ¨ä» Gitee æ‹‰å–ä»£ç å¹¶é‡å¯ Dockerã€‚

---

## å·¥ä½œåŸç†

1. **å®šæ—¶æ£€æŸ¥**: æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ Gitee æ˜¯å¦æœ‰æ–°ä»£ç 
2. **æ™ºèƒ½æ›´æ–°**: 
   - å¦‚æœåªæ˜¯ä»£ç å˜åŒ– â†’ å¿«é€Ÿé‡å¯å®¹å™¨ï¼ˆ10 ç§’ï¼‰
   - å¦‚æœä¾èµ–å˜åŒ– â†’ é‡å»ºé•œåƒå†é‡å¯ï¼ˆ1-2 åˆ†é’Ÿï¼‰
3. **è‡ªåŠ¨å›æ»š**: å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œè‡ªåŠ¨å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬

---

## å¸¸ç”¨å‘½ä»¤

```bash
# æ‰‹åŠ¨è§¦å‘éƒ¨ç½²
./deploy.sh

# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
tail -f deploy.log

# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡
crontab -l

# ä¿®æ”¹æ£€æŸ¥é¢‘ç‡
crontab -e
# æ”¹æˆæ¯ 10 åˆ†é’Ÿ: */10 * * * * cd /path/to/project && ./deploy.sh >> deploy.log 2>&1
```

---

## æ³¨æ„äº‹é¡¹

### 1. ç¡®ä¿ Git é…ç½®æ­£ç¡®

```bash
# æ£€æŸ¥è¿œç¨‹ä»“åº“
git remote -v

# å¦‚æœæ˜¯ HTTPSï¼Œé…ç½®å‡­æ®ç¼“å­˜
git config --global credential.helper store
git pull  # è¾“å…¥ä¸€æ¬¡ç”¨æˆ·åå¯†ç åä¼šè®°ä½

# æˆ–è€…ä½¿ç”¨ SSHï¼ˆæ¨èï¼‰
# åœ¨ Gitee æ·»åŠ æœåŠ¡å™¨çš„ SSH å…¬é’¥
ssh-keygen -t rsa -C "your_email@example.com"
cat ~/.ssh/id_rsa.pub  # å¤åˆ¶åˆ° Gitee
```

### 2. ç¡®ä¿ Docker æƒé™

```bash
# å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° docker ç»„
sudo usermod -aG docker $USER

# é‡æ–°ç™»å½•æˆ–è¿è¡Œ
newgrp docker
```

### 3. ä¿®æ”¹åˆ†æ”¯å

å¦‚æœä½ çš„ä¸»åˆ†æ”¯ä¸æ˜¯ `main`ï¼Œç¼–è¾‘ `deploy.sh`ï¼š

```bash
BRANCH="master"  # æ”¹æˆä½ çš„åˆ†æ”¯å
```

---

## æµ‹è¯•éƒ¨ç½²

```bash
# 1. æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡
./deploy.sh

# 2. æŸ¥çœ‹æ—¥å¿—
tail -f deploy.log

# 3. æ£€æŸ¥æœåŠ¡
docker-compose ps
curl http://localhost:8000/health
```

---

## å–æ¶ˆè‡ªåŠ¨éƒ¨ç½²

```bash
# åˆ é™¤å®šæ—¶ä»»åŠ¡
crontab -e
# åˆ é™¤åŒ…å« deploy.sh çš„é‚£ä¸€è¡Œ
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šå®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ

```bash
# æ£€æŸ¥ cron æœåŠ¡
sudo systemctl status cron

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
grep CRON /var/log/syslog
```

### é—®é¢˜ï¼šGit æ‹‰å–å¤±è´¥

```bash
# æ‰‹åŠ¨æµ‹è¯•
cd /path/to/project
git pull

# å¦‚æœæç¤ºæƒé™é—®é¢˜ï¼Œé…ç½® Git å‡­æ®
git config --global credential.helper store
```

### é—®é¢˜ï¼šDocker é‡å¯å¤±è´¥

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs middleware

# æ‰‹åŠ¨é‡å¯æµ‹è¯•
docker-compose restart middleware
```

---

## å®Œæ•´æµç¨‹ç¤ºä¾‹

```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /root/api-middleware
bash setup-auto-deploy.sh

# åœ¨æœ¬åœ°å¼€å‘
git add .
git commit -m "æ›´æ–°ä»£ç "
git push

# ç­‰å¾… 5 åˆ†é’Ÿï¼ŒæœåŠ¡å™¨è‡ªåŠ¨æ›´æ–°
# æˆ–æ‰‹åŠ¨è§¦å‘: ssh user@server "cd /root/api-middleware && ./deploy.sh"
```

---

å°±è¿™ä¹ˆç®€å•ï¼ğŸ‰
